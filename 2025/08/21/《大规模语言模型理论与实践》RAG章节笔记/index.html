

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="hejiaman">
  <meta name="keywords" content="">
  
    <meta name="description" content="《大规模语言模型理论与实践》第二版：原书资料链接🔗  RAG系统框架RAG核心在于将外部检索与生成模块有机整合，通过动态引入外部知识来提升生成结果的准确性和可靠性。    RAG任务分级根据任务认知处理层次划分，可分为显性事实查询（Explicit Facts Query）、隐性事实查询（Implicit Facts Query）、可解释推理查询（Interpretable Rationale">
<meta property="og:type" content="article">
<meta property="og:title" content="《大规模语言模型理论与实践》RAG章节笔记">
<meta property="og:url" content="http://example.com/2025/08/21/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Barbara">
<meta property="og:description" content="《大规模语言模型理论与实践》第二版：原书资料链接🔗  RAG系统框架RAG核心在于将外部检索与生成模块有机整合，通过动态引入外部知识来提升生成结果的准确性和可靠性。    RAG任务分级根据任务认知处理层次划分，可分为显性事实查询（Explicit Facts Query）、隐性事实查询（Implicit Facts Query）、可解释推理查询（Interpretable Rationale">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/rag_frame.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/model_rag.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/1.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/2.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/3.png">
<meta property="og:image" content="http://example.com/4.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/5.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/6.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/7.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/8.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/9.png">
<meta property="og:image" content="http://example.com/%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/10.png">
<meta property="article:published_time" content="2025-08-21T08:10:31.000Z">
<meta property="article:modified_time" content="2025-08-22T13:58:33.097Z">
<meta property="article:author" content="hejiaman">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/rag_frame.png">
  
  
  
  <title>《大规模语言模型理论与实践》RAG章节笔记 - Barbara</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":60,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Barbara</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="《大规模语言模型理论与实践》RAG章节笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-08-21 16:10" pubdate>
          2025年8月21日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          25 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">《大规模语言模型理论与实践》RAG章节笔记</h1>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>《大规模语言模型理论与实践》第二版：<a target="_blank" rel="noopener" href="https://intro-llm.github.io/">原书资料链接🔗</a></p>
</blockquote>
<h2 id="RAG系统框架"><a href="#RAG系统框架" class="headerlink" title="RAG系统框架"></a>RAG系统框架</h2><p>RAG核心在于将<strong>外部检索</strong>与<strong>生成模块</strong>有机整合，通过动态引入外部知识来提升生成结果的准确性和可靠性。</p>
<p><img src="/rag_frame.png" srcset="/img/loading.gif" lazyload alt="RAG系统框架" title="RAG系统框架示意图">  </p>
<h2 id="RAG任务分级"><a href="#RAG任务分级" class="headerlink" title="RAG任务分级"></a>RAG任务分级</h2><p>根据任务认知处理层次划分，可分为显性事实查询（Explicit Facts Query）、隐性事实查询（Implicit Facts Query）、可解释推理查询（Interpretable Rationales Query）以及隐性推理查询（Hidden Rationales Query）等四个层级。</p>
<h2 id="模块化RAG架构"><a href="#模块化RAG架构" class="headerlink" title="模块化RAG架构"></a>模块化RAG架构</h2><p>同济大学王昊奋教授团队借鉴了模块化设计的思想，提出了模块化检索增强生成架构（Modular RAG）。原文连接：<a target="_blank" rel="noopener" href="https://ojs.aaai.org/index.php/AAAI/article/view/29934">LLMEval: A Preliminary Study on How to Evaluate Large Language Models</a></p>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/model_rag.png" srcset="/img/loading.gif" lazyload alt="Modular RAG 架构"></p>
<h3 id="索引模块"><a href="#索引模块" class="headerlink" title="索引模块"></a>索引模块</h3><p>该模块的核心任务是将文档划分为可管理的chunk（块），为后续的检索和生成提供组织良好的内容基础，</p>
<p>目前方法：</p>
<ul>
<li>块优化：<ol>
<li>向量块优化：用<strong>滑动窗口</strong>方法通过在相邻片段之间引入重叠区域</li>
<li>语义块切分：对文档分段，并对每一段<strong>生成嵌入向量</strong>，通过比较相邻段落的向量相似度进行合并</li>
<li>小到大：通过将用于检索的片段与用于生成的片段分开处理</li>
</ol>
</li>
<li>结构优化<ol>
<li>层次化索引：通过建立父节点和子节点之间的关联关系，将文档内容分解为不同层次的片段，并链接到相应的节点上</li>
<li>知识图谱索引：通过将文档组织为图结构，明确概念与实体之间的关系</li>
</ol>
</li>
</ul>
<h3 id="检索前优化"><a href="#检索前优化" class="headerlink" title="检索前优化"></a>检索前优化</h3><p>预检索模块通过对用户查询进行重构、扩展或语义优化，能够减少语言歧义和表述模糊，从而为下游检索任务提供更精准的输入。主要模块如下：</p>
<ol>
<li><p>查询扩展：通过将单一查询<strong>扩展</strong>为多个查询的方法，用以丰富查询的内容，从而弥补原始查询中可能缺乏的细节和语义信息</p>
</li>
<li><p>查询转换：对用户输入的查询进行<strong>语义优化</strong>、<strong>语言简化</strong>或<strong>结构调整</strong>，使其更加明确和精确，便于模型识别核心意图并生成相关答案</p>
</li>
<li><p>查询结构化：将用户的查询重新构建为适应不同数据类型，例如<strong>结构化数据</strong>（如表格和图形数据）的查询</p>
</li>
</ol>
<h2 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h2><p>检索模块需要能够高效地处理大量的文本数据，并且需要能够准确地识别和匹配查询和文档之间的语义相似性。目前的检索主要分为：稀疏检索、稠密检索和混合检索。</p>
<ol>
<li>稀疏检索</li>
</ol>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/1.png" srcset="/img/loading.gif" lazyload alt="稀疏检索架构图"></p>
<p>其特点为：</p>
<ul>
<li>是一种基于统计特征的方法</li>
<li>通过将查询或文档转换为稀疏向量（大部分元素为0的向量）来实现检索</li>
<li>适用场景：大规模文档库的检索任务</li>
<li>优点：计算复杂度较低，在资源有限或者实时性要求较高的场景中表现突出</li>
<li>缺点：在捕捉复杂语义关系上存在局限性，无法有效处理同义词、上下文语意等深层语义信息</li>
</ul>
<ol start="2">
<li>稠密检索</li>
</ol>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/2.png" srcset="/img/loading.gif" lazyload alt="稠密检索架构图"></p>
<p>其特点为：</p>
<ul>
<li>通过DRL将查询或文档编码为稠密向量	</li>
<li>依赖于预训练语言模型活特定的双塔模型生成语义嵌入</li>
<li>优点：具有强大的语义表达能力，可以处理同义词等深层语义信息</li>
<li>缺点：在计算成本和存储要求方面有局限性</li>
</ul>
<ol start="3">
<li>混合检索</li>
</ol>
<p>将稀疏向量和稠密向量的得分进行融合活在检索流程中分阶段使用</p>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/3.png" srcset="/img/loading.gif" lazyload alt="混合检索架构图"></p>
<h2 id="检索后优化"><a href="#检索后优化" class="headerlink" title="检索后优化"></a>检索后优化</h2><p>通过对检索内容进行后处理，解决“中间遗忘”、“噪声&#x2F;反事实”文本以及上下文窗口长度有限等问题。该部分的常见组成部分包括重排序（Rerank）、内容压缩以及内容选择等步骤。</p>
<ol>
<li><p>重排序<br>其主要目的是对检索到的文章片段（chunks）进行重新排序，以提升结果的相关性和多样性。</p>
<ol>
<li>基于规则：计算指标对chunk进行排序；指标包多样性，相关性和最大边际相关性</li>
<li>基于模型：计算chunk与查询之间的相关性来排序</li>
</ol>
</li>
<li><p>内容压缩<br>压缩的核心目标是通过内容压缩减少噪声，同时保留信息完整性，以提高语言模型的推理效率。</p>
<ol>
<li>通过小语言模型对检索内容进行对齐和预训练</li>
<li>利用大语言模型对检索内容进行评估</li>
</ol>
</li>
<li><p>内容选择<br>关键在于计算输入内容的自信息量（一种衡量内容信息价值的指标）</p>
</li>
</ol>
<h2 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h2><p>生成模块是整个 RAG 系统的的核心模块，负责利用大语言模型结合用户查询与检索到的上<br>下文信息生成答案</p>
<h2 id="编排"><a href="#编排" class="headerlink" title="编排"></a>编排</h2><p>编排模块是RAG系统<strong>核心控制单元</strong>，负责在关键节点进行决策并动态选择后续步骤。主要模块包括路由（Routing）、调度（Scheduling）以及融合（Fusion）。</p>
<ol>
<li><p>路由<br>通过路由机制将查询分配到针对不同场景设计的特定管道中</p>
<ol>
<li>元数据路由：</li>
</ol>
<pre><code class="hljs"> a. 基于查询中提取的关键术语或实体，通过与预设关键词集合的匹配来优化路由流程
 b. 适合对显性关键词高度敏感的场景
 c. 匹配分数由关键词的重叠比例计算得出
</code></pre>
<ol start="2">
<li>语义路由</li>
</ol>
<pre><code class="hljs"> a. 依赖查询的语义信息，通过语言模型计算查询与预定义意图的匹配概率
</code></pre>
<ol start="3">
<li>混合路由</li>
</ol>
<pre><code class="hljs"> a. 通过引入权重因子，混合路由在元数据匹配和语义分析之间找到平衡点，从而实现更精确的路由选择
</code></pre>
</li>
<li><p>调度<br>   调度模块的作用是识别关键节点，负责管理和协调系统的各个流程，是否需要启动进一步的检索等</p>
<ol>
<li>规则判定：</li>
</ol>
<pre><code class="hljs">a. 用于评估生成答案的质量并决定进一步的操作
b. 通过评分机制对生成的答案进行质量评估，并根据预设的阈值判断是否继续或终止生成过程
</code></pre>
<ol start="2">
<li>LLM判断</li>
</ol>
<pre><code class="hljs">a. 利用LLM的上下文学习能力
b. 通过对LLM进行微调
</code></pre>
<ol start="3">
<li>知识引导调度</li>
</ol>
<pre><code class="hljs">a. 通过知识图谱引导信息检索与生成过程
</code></pre>
</li>
<li><p>融合<br>当系统拓宽检索范围或探索多条管道以提升生成内容的多样性时，融合模块负责高效<strong>整合</strong>各分支生成的信息。融合模块主要包含大语言模型融合、加权集成以及倒数排名融合等方法。</p>
<ol>
<li><p>大语言模型融合：<br>  利用大语言模型强大的分析与整合能力，将不同分支的信息进行统一处理。为了解决超出上下文窗口限制的长答案时，通过先对每个分支的答案进行<strong>摘要提取</strong>后再输入LLM的方式来进行整合。</p>
</li>
<li><p>加权集成：<br>  是一种基于多分支生成结果的加权选择方法，通过不同分支生成的词元（token）的加权值来综合选择最终输出。</p>
</li>
<li><p>倒数排名融合：<br>  它通过一种定制的<strong>加权平均方法</strong>，增强了整体预测性能与排名精度。适合处理模型或来源异构的场景。</p>
</li>
</ol>
</li>
</ol>
<h2 id="RAG系统模式"><a href="#RAG系统模式" class="headerlink" title="RAG系统模式"></a>RAG系统模式</h2><h3 id="线性模式"><a href="#线性模式" class="headerlink" title="线性模式"></a>线性模式</h3><p>线性模式是最简单且最常用的工作流模式，其流程可以分为几个核心模块，包括预检索（Pre-Retrieval）、检索、后检索（Post-Retrieval）以及生成模块。</p>
<p><img src="/4.png" srcset="/img/loading.gif" lazyload alt="线性模型流程"></p>
<h3 id="条件模式"><a href="#条件模式" class="headerlink" title="条件模式"></a>条件模式</h3><p>条件模式是一种灵活的 RAG 流模式，其核心特点是在不同条件下选择不同的 RAG 流水线，<br>从而针对特定场景进行优化。具体来说，条件模式通过一个<strong>路由模块</strong>（Routing Module）实现模块的动态选择，该模块根据输入问题的性质决定接下来的流程。</p>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/5.png" srcset="/img/loading.gif" lazyload alt="条件模型流程"></p>
<p>条件模式的分支流通常在以下几个方面存在差异：检索来源、流程、模型配置以及提示设计</p>
<h3 id="分支模型"><a href="#分支模型" class="headerlink" title="分支模型"></a>分支模型</h3><p>分支模式通过<strong>并行运行</strong>多个分支的方式增加结果的多样性和鲁棒性。具体来说，分支模式在某个模块中生成多个并行分支，每个分支可以独立执行相同或不同的 RAG 流程。这些流程由多个处理模块组成，生成各自的分支输出结果。</p>
<p>分支模式可以根据不同任务需求设计为多种结构类型，通常分为两类：预检索分支模式、后检索分支模式。</p>
<h3 id="预检索分支-Pre-Retrieval-Branching"><a href="#预检索分支-Pre-Retrieval-Branching" class="headerlink" title="预检索分支(Pre-Retrieval Branching)"></a>预检索分支(Pre-Retrieval Branching)</h3><p>是一种通过生成多个<strong>子查询并行检索</strong>的模式，用于提高检索的全面性和生成结果的多样性。</p>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/6.png" srcset="/img/loading.gif" lazyload alt="预检索分支流程"></p>
<h3 id="后检索分支-Post-Retrieval-Branching"><a href="#后检索分支-Post-Retrieval-Branching" class="headerlink" title="后检索分支(Post-Retrieval Branching)"></a>后检索分支(Post-Retrieval Branching)</h3><p>该模式从<strong>单一查询</strong>开始，通过<strong>检索模块</strong>获取多个文档块。每个文档块被独立送入生成模块进行处理，生成对应的结果集合。随后，这些生成的结果通过合并模块进行整合，形成最终结果。</p>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/7.png" srcset="/img/loading.gif" lazyload alt="后检索分支流程"></p>
<h3 id="循环模式"><a href="#循环模式" class="headerlink" title="循环模式"></a>循环模式</h3><p>循环模式的核心是检索与生成步骤之间的<strong>相互依赖性</strong>。循环模式通过引入调度模块进行控制，确保系统可以根据需要在特定模块之间<strong>重复执行</strong>某些操作。</p>
<p>循环模式的关键在于<strong>判断模块</strong>（Judge Module），用于决定流程是否需要返回到之前的模块或继续向下执行。</p>
<p>循环模式可以进一步细分为三种类型：迭代型、递归型和自适应型（主动型）检索模式。</p>
<ol>
<li>迭代型循环模式：通过多次循环执行<strong>检索</strong>和<strong>生成</strong>操作，在每次迭代中逐步优化结果。在每一步迭代中，系统根据当前查询和之前的输出结果，检索相关的文档片段，然后利用这些文档生成新的输出。迭代过程通常设置一个<strong>最大迭代次数</strong>的限制，以避免无限循环。</li>
</ol>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/8.png" srcset="/img/loading.gif" lazyload alt="迭代型循环模式"></p>
<ol start="2">
<li>递归型循环检索模式：一种具有明显<strong>依赖性</strong>和<strong>层次性</strong>的检索方式。其显著特点在于每一步都依赖于前一步的输出，并通过不断加深检索过程，逐步挖掘更深层次的信息。递归型检索还包含明确的<strong>退出机制</strong>，用以确保在满足终止条件时流程终止，避免无限递归。递归型循环模式通过查询转换模块生成新的查询，以推动检索逐层深入。</li>
</ol>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/9.png" srcset="/img/loading.gif" lazyload alt="递归型循环检索模式"></p>
<ol start="3">
<li><p>自适应型（主动型）模式：是一种超越传统被动检索模式的新兴模式，这种模式的核心思想类似于大语言模型智能体，通过<strong>动态调整检索流程</strong>，主动决定何时进行检索以及何时终止流程并生成最终结果。  </p>
<p> 自适应型检索通常根据判断标准进一步细分为两种方法：基于提示的方法和基于指令微调的方法。</p>
<ol>
<li>基于提示的方法：通过<strong>设计动态提示</strong>对模型进行引导；</li>
<li>基于指令微调的方法：利用<strong>指令微调</strong>的方法实现更精准的检索控制。</li>
</ol>
</li>
</ol>
<p><img src="/./%E3%80%8A%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%E3%80%8BRAG%E7%AB%A0%E8%8A%82%E7%AC%94%E8%AE%B0/10.png" srcset="/img/loading.gif" lazyload alt="自适应型（主动型）模式"></p>
<h2 id="RAG系统训练与优化"><a href="#RAG系统训练与优化" class="headerlink" title="RAG系统训练与优化"></a>RAG系统训练与优化</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/LLM/" class="category-chain-item">LLM</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>《大规模语言模型理论与实践》RAG章节笔记</div>
      <div>http://example.com/2025/08/21/《大规模语言模型理论与实践》RAG章节笔记/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>hejiaman</div>
        </div>
      
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2025年8月22日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/08/21/MyBatis-Plus%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="MyBatis-Plus学习记录">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MyBatis-Plus学习记录</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/08/20/Redis%E9%A1%B9%E7%9B%AE%E5%8F%8A%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/" title="Redis项目及原理总结">
                        <span class="hidden-mobile">Redis项目及原理总结</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
